纹理是一种描述物体表面随空间变化的方式。它改变物体的外在表象而不改变物体的几何形状。更确切地说，纹理是一种从二维的纹理图像到三维的世界坐标的一种映射。对纹理上的一个点，我们称之为纹素（Texal）。

因此，对于图片表面上的每个顶点，我们都需要给它赋予一个在二维的纹理图像上的对应坐标，这个坐标被我们称为纹理坐标（texture coordinates），这是我们描述这种映射的方式。通常用 $u, v$ 来描述这组坐标，因此又称之为 u-v 坐标，其取值范围都为 $[0, 1]$ 。

注意，纹理图像和表面空间之间的映射未必是一一对应的。为了减少纹理图像的大小，我们往往会通过反复映射来处理一些高度重复的部分。

## 纹理坐标的生成

上面的描述都假定纹理坐标已知，接下来我们描述如何生成一个纹理坐标。对于一个参数化曲面构建的物体，我们会使用它上面的参数作为坐标。但是如果不是以这种方式描述的表面，我们的处理方式往往会变得比较复杂。最常见的方法是使用投影。

对于 $z$ 方向上不发生变化的情形，我们可以使用平面投影，将其投影到 $xOy$ 平面上，然后描述其纹理；否则，我们可以使用球面投影，将其投影到一个单位球上（考虑 Gauss 映射），然后使用球面上的坐标；但是，球面投影会出现奇点，所以我们可以使用立方体投影；对于复杂的表面，我们不能让其受限于一个立方体，因此，我们采取分治的策略，将物体分成多个部分，并对每个部分做投影并表示其结果。

在工业上对于一个一般的物体，我们一般会在用切割-摊平-打包的方式。我们会采用共形映射的方式去寻找摊平的方式，如果不能摊平，则将其切开，然后最后将各个部分的纹理打包。因为对于三维表面的局部来说，寻找一个摊平的方式一般都是简单的；而对于曲率较大的情形或者映射不能统一的情形，我们使用切割开的方法；最后，将切开之后的东西打包。

## 纹理与重采样过程

事实上，应用纹理的方法可以被视作一个重采样（resample）的过程。对于屏幕上的每个坐标，我们计算其对应的纹理坐标，然后在纹理空间中对这个坐标做一个采样，得到它上面的颜色。当然，这个颜色可以参与运算，用来实现复杂的光照效果。

注意，我们存储纹理的图像已经是采样后的过程，它是一种离散化的表达。为了使用这种信号，我们要把这种表达对重建滤波（reconstruction filter）做一个卷积来恢复原来的连续函数；然后，我们对这个连续函数再次采样得到屏幕上坐标对应的函数值。

因此，在发生采样的时候会出现的问题在纹理上也会出现。锯齿和摩尔纹是最常见的问题。对于锯齿，是因为我们没有进行插值而出现了一对多的情况；对于摩尔纹，是因为我们的采样率不够而发生了失真。可以类比图像放大缩小时的问题。对于放大的情形，一个 Texal 对应多个 Pixel；对于缩小的情形，多个 Texal 对应一个 Pixel；这两种情形也被称为上采样（upsampling）和下采样（downsampling）。

当然，使用雅可比矩阵可以估计面积微元对应的面积，这就是采样率。事实上，它就是 $\det \hat J$ ：
$$
\det \hat J = \det \begin{bmatrix}
\frac {\partial u}{\partial x} & \frac {\partial u}{\partial y}\\
\frac {\partial v}{\partial x} & \frac {\partial v}{\partial y}
\end{bmatrix} = (\frac {\partial u}{\partial x}, \frac {\partial u}{\partial y}) \times (\frac {\partial v}{\partial x}, \frac {\partial v}{\partial y})
$$

为了处理这种问题，对于放大过程，我们要施加插值来防止出现过于僵硬的边缘。最常用的方法是做双线性滤波（bilinear filtering）。取四个与其最接近的纹素，然后使用线性的方式对其完成插值。定义 $\mathrm{lerp}(x, v_0, v_1) = v_0 + x(v_1 - v_0)$，然后对横向和纵向同时插值之后做一个乘积即可。

而对于缩小过程，我们需要去掉纹理上的高频信号。但是这种变换不能是均匀的。因此，我们使用 mipmap 的方法来处理。每次降采样两倍构造金字塔形的结果，然后利用级数求和的方式将其重新存储为方形。我们通过差分求算它应该在 mipmap 中的第几层，也就是要求算采样率，当然，可以用最大长度 $L = \max\{\Vert\frac {\partial u}{\partial x}, \frac {\partial u}{\partial y}\Vert, \Vert \frac {\partial v}{\partial x}, \frac {\partial v}{\partial y}\Vert\}$ 的对数值 $\log_2 L$ 来估计。

为了保证更好的连续性，我们在 mip level 上再做一次线性插值，这被称为三线性插值（trilinear interpolation）。

但是这时候，我们还是会发现远处的结果是模糊的。因为在 mipmap 中，我们假定远处的图像对应的是一个很长的形状，而我们前滤波（prefilter）的情形是圆形的。对于这种情形，我们使用椭圆加强平均滤波（elliptical weighted average filtering, EWA filtering）。

## 高级纹理映射技术

纹理可以被视为内存加上滤波。这种东西可以被送进片段着色器去计算，一种方式是环境光照，使用片段着色器去做到模拟光追的效果。利用偏移映射（displacement mapping）改变原始顶点的位置或者利用泵映射（bump mapping）改变顶点法向量的方向可以实现物体上面的局部小结构。

当然，我们也可以直接将一个三维的结构映射到物体上；也可以预计算全局阴影；我们甚至也可以使用双向纹理（bidirectional texture function, BTF），它是一个六维函数，输入是光照方向和观察方向，这是一种高度数据驱动的方法，可以实现相当真实的结果。
